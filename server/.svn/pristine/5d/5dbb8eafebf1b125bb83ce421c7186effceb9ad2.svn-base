using System;
using System.Collections.Generic;
using System.Text;
using System.Xml;
using Server.Commands;
using Server.Items;
using Server.Mobiles;
using Server.Gumps;
using Server.Scripts.Custom.Citizenship;
using Server.Scripts.Custom;
using Server.Factions;

namespace Server.Regions
{
    public class MilitiaStronghold : BaseRegion
    {

        private int mRegionId;
        private const float mTakeOverTimeInSeconds = 10f;
        private ICommonwealth mOwner;

        public ICommonwealth Owner { get { return mOwner; } set { mOwner = value; } }

        public MilitiaStronghold(ICommonwealth owner) : 
            base("Test Stronghold", Map.Felucca, 0, new Rectangle2D[]{ new Rectangle2D(500, 500, 10, 10)})
        {
            mOwner = owner;
            mOwner.HeroHomeRegion = this;
        }

        public MilitiaStronghold(XmlElement xml, Map map, Region parent)
            : base(xml, map, parent)
        {
            XmlElement id = xml["heroinfo"];
            ReadInt32(id, "id", ref mRegionId);

            XmlElement townshipElement = xml["townshipinfo"];
            string townshipName = string.Empty;
            ReadString(townshipElement, "name", ref townshipName);
            mOwner = Commonwealth.Find(townshipName);
            mOwner.HeroHomeRegion = this;
        }

        public override void OnEnter(Mobile m)
        {
            if(!(m is PlayerMobile))
                return;

            m.SendMessage("Entering the militia stronghold of " + mOwner.Definition.TownName);
            if (m.AccessLevel > AccessLevel.Player)
                return;
            ICommonwealth playerTownship = Commonwealth.Find(m);

            if (playerTownship == null)
            {
                m.SendMessage("Only citizens and militia members may enter strongholds.");             
                Timer.DelayCall(TimeSpan.FromSeconds(1.0), new TimerCallback(((PlayerMobile)m).ReturnToGalven));
             
            }
            else if (playerTownship != mOwner && Faction.Find(m) == null)
            {
                m.SendMessage("You may not enter the stronghold of another township unless you are in the militia.");
                Timer.DelayCall(TimeSpan.FromSeconds(1.0), new TimerCallback(((PlayerMobile)m).ReturnToGalven));
            }
        }

        public override void OnExit(Mobile m)
        {
         
        }

       
    }
}

